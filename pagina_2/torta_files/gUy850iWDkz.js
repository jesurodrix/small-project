;/*FB_PKG_DELIM*/

__d("isReceiverFetchSticker",["I64","LSIntEnum","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.attachmentType;b=(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER));a=a.receiverFetchId;return b&&a!=null}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatus",["I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSendAndReceive","MAWDbMedia","MAWMediaDownloadStatus","MAWStateContext.react","MessagingAttachmentType","WAHashUtils","gkx","isReceiverFetchSticker","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useContext,l=b.useEffect,m=b.useMemo,n=new Set();function a(a){var b=d("MAWStateContext.react").useMAWSelector(function(a){return a.mediaDownloadStatus}),e=d("MAWStateContext.react").useMAWSelector(function(a){return a.mediaDownloadRetryCount}),f=m(function(){return a.map(function(a,f){var g=a.attachment;a=a.mediaRenderQpl;var h=c("isReceiverFetchSticker")(g),k=(i||(i=d("I64"))).equal(g.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA)),l=h?g.messageId:g.attachmentFbid,m=Object.prototype.hasOwnProperty.call(b,l),n=g.transportKey==="FBBroker"||g.transportKey==="FBLegacyBroker";g=!n&&(i||(i=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;var o=g?{mainMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,mainMediaStatusDetails:"optimistic_secure_upload",previewMediaStatus:c("MAWMediaDownloadStatus").SUCCESS,previewMediaStatusDetails:"optimistic_secure_upload"}:m?b[l]:null;return{attachmentsData:{hasStatus:m,isOpenThreadAttachment:n,isOptimisticSecureUpload:g,isReceiverFetch:h,isXMA:k,retryCount:(m=e[l])!=null?m:0,status:o,statusKey:l},index:f,mediaRenderQpl:a}})},[a,e,b]);o(f);return f.map(function(a){a=a.attachmentsData;return a})}function o(a){var b=k(d("MAWStateContext.react").MAWStateContext),e=b.dispatch;l(function(){a.forEach(function(a){var b=a.attachmentsData,f=a.index,g=a.mediaRenderQpl;a=b.hasStatus;var h=b.isOpenThreadAttachment,i=b.isOptimisticSecureUpload,j=b.isReceiverFetch,k=b.isXMA,l=b.statusKey;if(k||i||h||j||l==null||a||n.has(l))return;n.add(l);var m=c("gkx")("5759")||isNaN(l);g==null?void 0:g.addPoint("fetch-initial-download-status-"+f+"-start",{string:{fetch_by:m?"plaintext_hash":"media_id"}});b=m?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByPlaintextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(l),qplInstanceKey:g==null?void 0:g.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(l,10)),qplInstanceKey:g==null?void 0:g.getInstanceKey()});c("promiseDone")(b.then(function(a){g==null?void 0:g.addPoint("fetch-initial-download-status-"+f+"-end",{bool:{has_result:a!=null},string:{fetch_by:m?"plaintext_hash":"media_id",main_media_status:p(a==null?void 0:a.mainMediaStatus),preview_media_status:p(a==null?void 0:a.previewMediaStatus)}}),a!=null&&e({tag:"SetMediaDownloadStatusState",value:{key:m?d("WAHashUtils").stringToPlaintextHash(l):d("MAWDbMedia").convertNumberToMediaId(parseInt(l,10)),newMediaDownloadState:a}})}))})},[e,a])}function p(a){if(a==null)return"UNKNOWN";switch(a){case c("MAWMediaDownloadStatus").DOWNLOADING:return"DOWNLOADING";case c("MAWMediaDownloadStatus").SUCCESS:return"SUCCESS";case c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE:return"NOT_MANUAL_RETRYABLE_FAILURE";case c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE:return"MANUAL_RETRYABLE_FAILURE";case c("MAWMediaDownloadStatus").MISSING_FILE:return"MISSING_FILE"}}g["default"]=a}),98);
__d("useMAWBulkMediaDownloadStatusUIState",["I64","LSIntEnum","LSMediaUrlUtils","MAWLoggerUtils","MAWMediaDownloadStatus","MessagingAttachmentType","WATagsLogger","react","useMAWBulkMediaDownloadStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["useMAWMediaDownloadStatusUIState: unexpected download status"]);k=function(){return a};return a}var l=(h||d("react")).useMemo,m=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload]),n=5;function a(a){var b=c("useMAWBulkMediaDownloadStatus")(a);return l(function(){return b.map(function(b,e){var f,g=b.retryCount;b=b.status;f=(f=b)!=null?f:{};var h=f.mainMediaStatus;f=f.previewMediaStatus;e=a[e].attachment;if(e.receiverFetchId!=null&&d("LSMediaUrlUtils").hasValidReceiverFetchPreviewUrl(e.previewUrl,e.previewUrlExpirationTimestampMs))return"downloaded";g=g>=n;var i=b==null||h===c("MAWMediaDownloadStatus").DOWNLOADING||h===c("MAWMediaDownloadStatus").MISSING_FILE,j=h===c("MAWMediaDownloadStatus").SUCCESS,l=h===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,p=l&&g;h=h===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE;b=b==null||f===c("MAWMediaDownloadStatus").DOWNLOADING||f===c("MAWMediaDownloadStatus").MISSING_FILE||f===void 0&&i;var q=f===c("MAWMediaDownloadStatus").SUCCESS,r=f===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE||f===void 0&&l;g=r&&g;f=f===c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE||f===void 0&&h;e=o(e);if(e&&!b){if(q||j){if(h||p)return"non_retryable_error_with_preview";else if(l)return"retryable_error_with_preview";return"downloaded"}else if(f||g)return"non_retryable_error";else if(r)return"retryable_error"}else if(j)return"downloaded";else if(h||p)return"non_retryable_error";else if(l)return"retryable_error";else if(i)return"loading";m.WARN(k());return"loading"})},[a,b])}function o(a){if(a==null)return!1;a=a.attachmentType;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))}g["default"]=a}),98);
__d("useMAWMediaDownloadStatusUIState",["react","useMAWBulkMediaDownloadStatusUIState"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useMemo;function a(a,b){var d=i(function(){return a!=null?[{attachment:a,mediaRenderQpl:b}]:[]},[a,b]);d=c("useMAWBulkMediaDownloadStatusUIState")(d);return d.length>0?d[0]:null}g["default"]=a}),98);